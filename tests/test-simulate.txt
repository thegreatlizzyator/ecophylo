The ``ecophylo`` module
======================

Using ``simulate``
-------------------
Author : Maxime Jaunatre <maxime.jaunatre@yahoo.fr>

This is an example text file in reStructuredText format.  First import
``simulate`` from the ``ecophylo`` module:

    >>> from ecophylo import simulate

Now use it:

testing samples
    >>> t = simulate(samples = "2", com_size = 1, mu = 1, 
    ...  init_rates = None, 
    ...  changetime = None, mrca = None, 
    ...  migr = 1, migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: samples should all be ints
    >>> t = simulate(samples = ["2", 1], com_size = 1, mu = 1, 
    ...  init_rates = None, 
    ...  changetime = None, mrca = None, 
    ...  migr = 1, migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: samples should all be ints
    >>> t = simulate(samples = -1, com_size = 1, mu = 1, 
    ...  init_rates = None, 
    ...  changetime = None, mrca = None, 
    ...  migr = 1, migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: samples should all be positive
    >>> t = simulate(samples = [2, -1], com_size = 1, mu = 1, 
    ...  init_rates = None, 
    ...  changetime = None, mrca = None, 
    ...  migr = 1, migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: samples should all be positive

# testing com_size
    >>> t = simulate(samples = 5, com_size = [10, 30], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = None, mrca = None, 
    ...  migr = 1, migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: there should be as many elements in com_size as there are demes
    >>> t = simulate(samples = 5, com_size = [1], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = None, mrca = None, 
    ...  migr = 1, migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: com_size must be superior to samples
    >>> t = simulate(samples = 5, com_size = -1, mu = 1, 
    ...  init_rates = None, 
    ...  changetime = None, mrca = None, 
    ...  migr = 1, migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: community sizes should be strictly positive int
    >>> t = simulate(samples = 5, com_size = "many", mu = 1, 
    ...  init_rates = None, 
    ...  changetime = None, mrca = None, 
    ...  migr = 1, migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: community sizes should be strictly positive int
    >>> t = simulate(samples = [5, 5], com_size = [10, -30], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = [[0], [0]], mrca = None, 
    ...  migr = 1, migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: all past sizes should be strictly positive
    >>> t = simulate(samples = [5, 5], com_size = [[10], [30]], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = [[0, 20], [0]], mrca = None, 
    ...  migr = 1, migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: there should be as many past com_size as there are epochs in changetime
    >>> t = simulate(samples = [5, 5], com_size = [[10], [-30]], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = [[0], [0]], mrca = None, 
    ...  migr = 1, migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: all past sizes should be strictly positive

testing mu
    >>> t = simulate(samples = 2, com_size = [[500]], mu = -1, 
    ...  init_rates = None, 
    ...  changetime = None, mrca = None, 
    ...  migr = 1, migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: mu must be a float between 0 and 1
    >>> t = simulate(samples = 2, com_size = [[500]], mu = 10, 
    ...  init_rates = None, 
    ...  changetime = None, mrca = None, 
    ...  migr = 1, migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: mu must be a float between 0 and 1
    >>> t = simulate(samples = 2, com_size = [[500]], mu = "0.5", 
    ...  init_rates = None, 
    ...  changetime = None, mrca = None, 
    ...  migr = 1, migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: mu must be a float between 0 and 1

testing init_rates
    >>> t = simulate(samples = 2, com_size = [[500]], mu = 1, 
    ...  init_rates = "make babies", 
    ...  changetime = [[0]], mrca = None, 
    ...  migr = 1, migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: init_rates must be float, list of float or nested list of float
    >>> t = simulate(samples = 2, com_size = [[500, 200]], mu = 1, 
    ...  init_rates = [1, 2], 
    ...  changetime = [[0, 20]], mrca = None, 
    ...  migr = 1, migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: there should be as many elements in init_rates as there are demes
    >>> t = simulate(samples = 2, com_size = [[500]], mu = 1, 
    ...  init_rates = [[1, 2]], 
    ...  changetime = [[0]], mrca = None, 
    ...  migr = 1, migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: there should be as many past growth init_rates as there are epochs in changetime


testing changetime
# single value
    >>> t = simulate(samples = 2, com_size = [[20, 50]], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = "KT", mrca = None, 
    ...  migr = 1, migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: changetime must be int, list of int or nested list of int
    >>> t = simulate(samples = 2, com_size = [[20, 50]], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = -66, mrca = None, 
    ...  migr = 1, migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: changetime must be positive values

# list of val
    >>> t = simulate(samples = 2, com_size = [[20, 50]], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = [0, 0, 20] , mrca = None, 
    ...  migr = 1, migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: Duplicated times in changetime are not possible
    >>> t = simulate(samples = 2, com_size = [[20, 50]], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = [0, "KT", 20] , mrca = None, 
    ...  migr = 1, migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: changetime must be int, list of int or nested list of int
    >>> t = simulate(samples = 2, com_size = [[20, 50]], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = [0, -66, 20] , mrca = None, 
    ...  migr = 1, migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: changetime must be positive values
    >>> t = simulate(samples = 2, com_size = [[20, 50]], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = [66, 0, 20] , mrca = None, 
    ...  migr = 1, migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: first element of changetime must be equal to 0

# nested list of int
    >>> t = simulate(samples = 2, com_size = [[20, 50]], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = [[0, 0, 20]] , mrca = None, 
    ...  migr = 1, migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: Duplicated times in changetime for a Deme are not possible
    >>> t = simulate(samples = 2, com_size = [[20, 50]], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = [[0, "KT", 20]] , mrca = None, 
    ...  migr = 1, migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: changetime must be int, list of int or nested list of int
    >>> t = simulate(samples = 2, com_size = [[20, 50]], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = [[0, -66, 20]] , mrca = None, 
    ...  migr = 1, migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: changetime must be positive values
    >>> t = simulate(samples = 2, com_size = [[20, 50]], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = [[66, 0, 20]] , mrca = None, 
    ...  migr = 1, migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: first element of changetime for a Deme must be equal to 0

    >>> t = simulate(samples = 2, com_size = [[20, 50]], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = [[0, 20], [0, 20]] , mrca = None, 
    ...  migr = 1, migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: there should be as many past sizes as there are epochs in changetime
    
testing mrca

testing migr
# one rate
    >>> t = simulate(samples = [2, 2], com_size = [20, 50], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = None, mrca = None, 
    ...  migr = 0, migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: migration matrices cannot all be empty
    >>> t = simulate(samples = [2, 2], com_size = [20, 50], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = None, mrca = None, 
    ...  migr = -1, migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: migration rate should be positive (or zero) and not exceed 1
    >>> t = simulate(samples = [2, 2], com_size = [20, 50], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = None, mrca = None, 
    ...  migr = "0", migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: migration rate must be a float or an int.

# mult rates
    >>> t = simulate(samples = [2, 2], com_size = [20, 50], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = None, mrca = None, 
    ...  migr = [0, 1], migr_time = [30], 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: there should be as many migration rates or matrices as there are times in migr_time
    >>> t = simulate(samples = [2, 2], com_size = [20, 50], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = None, mrca = None, 
    ...  migr = ["0", 1], migr_time = [0, 30], 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: migration rate must be a float or an int.
    >>> t = simulate(samples = [2, 2], com_size = [20, 50], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = None, mrca = None, 
    ...  migr = [-0.5, 1], migr_time = [0, 30], 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: migration rate should be positive (or zero) and not exceed 1
    >>> t = simulate(samples = [2, 2], com_size = [20, 50], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = None, mrca = None, 
    ...  migr = [0, 0], migr_time = [0, 30], 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: migration matrices cannot all be empty

# matrix
    >>> t = simulate(samples = [2, 2], com_size = [20, 50], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = None, mrca = None, 
    ...  migr = [[0,0],[0,0]], migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: migration matrices cannot all be empty
    >>> t = simulate(samples = [2, 2], com_size = [20, 50], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = None, mrca = None, 
    ...  migr = [[0,0, 0],[0,0]], migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: custom migration matrices should be of size ndeme x ndeme
    >>> t = simulate(samples = [2, 2], com_size = [20, 50], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = None, mrca = None, 
    ...  migr = [[0, 1],[1, 0, 0]], migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: custom migration matrices should be of size ndeme x ndeme
    >>> t = simulate(samples = [2, 2], com_size = [20, 50], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = None, mrca = None, 
    ...  migr = [[0, 1],["1", 0]], migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: found custom migration matrix that is not made of ints or floats
    >>> t = simulate(samples = [2, 2], com_size = [20, 50], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = None, mrca = None, 
    ...  migr = [[0, "1"],[1, 0]], migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: found custom migration matrix that is not made of ints or floats
    >>> t = simulate(samples = [2, 2], com_size = [20, 50], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = None, mrca = None, 
    ...  migr = [[0, 1],[-1, 0]], migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: found custom migration matrix with negative migration rates or greater than 1
    >>> t = simulate(samples = [2, 2], com_size = [20, 50], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = None, mrca = None, 
    ...  migr = [[0, -1],[1, 0]], migr_time = None, 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: found custom migration matrix with negative migration rates or greater than 1

# matrix list
    >>> t = simulate(samples = [2, 2], com_size = [20, 50], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = None, mrca = None, 
    ...  migr = [[[0, -1],[1, 0]], [[0, -1],[1, 0]]], migr_time = [0], 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: there should be as many migration rates or matrices as there are times in migr_time
    >>> t = simulate(samples = [2, 2], com_size = [20, 50], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = None, mrca = None, 
    ...  migr = [[[0, 1, 1],[1, 0]]], migr_time = [0], 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: custom migration matrices should be of size ndeme x ndeme
    >>> t = simulate(samples = [2, 2], com_size = [20, 50], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = None, mrca = None, 
    ...  migr = [[[0, '1'],[1, 0]]], migr_time = [0], 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: found custom migration matrix that is not made of ints or floats
    >>> t = simulate(samples = [2, 2], com_size = [20, 50], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = None, mrca = None, 
    ...  migr = [[[0, -1],[1, 0]]], migr_time = [0], 
    ...  verbose = False, seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: found custom migration matrix with negative migration rates or greater than 1

testing verbose
    >>> t = simulate(samples = 2, com_size = [[20, 50]], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = [[0, 20]] , mrca = None, 
    ...  migr = 1, migr_time = None, 
    ...  verbose = "False", seed = None)
    Traceback (most recent call last):
      ...
    SystemExit: verbose must be a boolean

testing seed
    >>> t = simulate(samples = 2, com_size = [[20, 50]], mu = 1, 
    ...  init_rates = None, 
    ...  changetime = [[0, 20]] , mrca = None, 
    ...  migr = 1, migr_time = None, 
    ...  verbose = False, seed = "tournesol")
    Traceback (most recent call last):
      ...
    SystemExit: seed must be an integer


## Testing outputs

# one population test
## discret
### const
    >>> t = simulate(samples = [5], com_size = [[1e3]], mu = 0.03,
    ... seed = 42)
    >>> print(t)
    <BLANKLINE>
          /-4
       /-|
    --|   \-0
      |
       \-2

### fluct
    >>> t = simulate(samples = [5], com_size = [[1e3, 2e3]], 
    ... changetime = [[0, 50]], mu = 0.03, seed = 42)
    >>> print(t)
    <BLANKLINE>
          /-3
       /-|
    --|   \-0
      |
       \-2

## gr
### const
### fluct


# npop with K migr
## discret
### const
    >>> t = simulate(samples = [5, 5], com_size = [[1e5], [1e5]], 
    ... mu = 0.03, migr = 1, seed = 42)
    >>> print(t)
    <BLANKLINE>
          /-7
         |
       /-|      /-4
      |  |   /-|
      |   \-|   \-8
    --|     |
      |      \-0
      |
      |   /-3
       \-|
          \-1

### fluct
    >>> t = simulate(samples = [5, 5], com_size = [[1e3, 2e3], [1e3, 5e2]],
    ... changetime = [[0, 50],[0, 30]], mu = 0.03, migr = 1, seed = 42)
    >>> print(t)
    <BLANKLINE>
          /-2
       /-|
      |   \-0
      |
    --|         /-6
      |      /-|
      |   /-|   \-3
      |  |  |
       \-|   \-1
         |
          \-7

## gr
### const
### fluct


# npop with diff migr
## discret
### const
    >>> t = simulate(samples = [5, 5], com_size = [[1e3], [1e3]],
    ... changetime = [[0],[0]], mu = 0.03, migr = [0, 1], 
    ... migr_time = [0, 200], seed = 42)
    >>> print(t)
    <BLANKLINE>
          /-9
       /-|
      |   \-5
      |
    --|      /-3
      |   /-|
      |  |  |   /-1
      |  |   \-|
       \-|      \-0
         |
         |   /-2
          \-|
             \-6

### fluct
    >>> t = simulate(samples = [5, 5], com_size = [[1e3, 2e3], [1e3, 5e2]],
    ... changetime = [[0, 500],[0, 300]], mu = 0.03, migr = [0, 1], 
    ... migr_time = [0, 200], seed = 42)
    >>> print(t)
    <BLANKLINE>
          /-3
       /-|
      |  |   /-1
      |   \-|
    --|      \-0
      |
      |      /-6
      |   /-|
       \-|   \-2
         |
          \-5

## gr
### const
### fluct


# npop with vic
## discret
### const
### fluct

## gr
### const
### fluct


### Vignette cases ! # TODO : move this to code doc !
    >>> t = simulate(samples = [10], com_size = [[1e5]], mu = 0.03, seed = 42)
    >>> print(t)
    <BLANKLINE>
          /-1
       /-|
      |  |   /-8
      |   \-|
    --|      \-0
      |
      |   /-7
      |  |
       \-|      /-5
         |   /-|
          \-|   \-3
            |
             \-6
    >>> t = simulate(samples = [5, 5], com_size = [[1e5], [1e5]], mu = 0.03, migr = 1, seed = 42)
    >>> print(t)
    <BLANKLINE>
          /-7
         |
       /-|      /-4
      |  |   /-|
      |   \-|   \-8
    --|     |
      |      \-0
      |
      |   /-3
       \-|
          \-1