---
title: "Vignette ecophylo"
author: "Team bouclé"
date: "9 janvier 2021"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
library(reticulate)
knitr::opts_chunk$set(echo = TRUE)
use_python(Sys.which("python3"))
```

## Rules for working in Rmarkdown with python.

*we will need to check the setup chunk for location of python3 binary across different os (ubuntu work with this code)*

### Python chunks calling R obj.

R chunks works just fine as usual.

```{r}
a <- 42 # set a in R
```

This chunk only work when the markdown is knitted.
See that we can call R object when looking for them in 'r' namespace.

```{python}
print(r.a)
r.a += 1 # modify R variable in python
print(r.a)
b = 666 # set b in python
```

### R chunks calling Python obj.

See that we can call python object when looking for them in 'py' list.

```{r}
print(a) # call a in R after modification in python
print(py$b) # call b in R
# Also possible to call directly python function in r
rand <- import('numpy')$random # import python module numpy and submod random
rand$randint(3) # call of function randint
```

You can run python code in interactive mod in the console using the following 
function : *repl_python(quiet = T)*.
It set the console in 'python mode' so you can type in python commands. 
However you can't send lines from a chunk or a script.

To exit the consol in python, just type *exit* and tadaa the consol is back 
to R.

### Using Python modules in R.

```{r}
# Be carefull for idiotproof of ecophylo and int class !
eco <- import('ecophylo')
eco$timeframes(I=as.integer(3), T=2, a=0.3)
# make dataframes with pandas is same as R
pd <- import('pandas')
d <- list(col1 = c(1,2,3), col2 = c(4,5,6))
pd$DataFrame(d)
```

\newpage

# Serious Part #####

## Introduction

## Installation

The packages can be installed from the public repository Pypi with the `pip` tool.

You can also download the *tar.gz* file from the repository and install it with pip. You need to use python3 and install the dependencies before. Note that it is a development stage.

**impossible at this moment as the repository is private**

```{bash, eval=FALSE}
python3 -m pip install ecophylo
# NOT RUN
# wget -L https://github.com/thegreatlizzyator/ecophylo/blob/master/dist/ecophylo-0.0.5.tar.gz
# python3 -m pip install ecophylo-0.0.5.tar.gz
```

### Installation on Windows (the painfull way)

> For François : First create a new project in rstudio with **version control** from the [github](https://github.com/thegreatlizzyator/ecophylo). 

You will need to install `{reticulate}` package and python dependencies.

```{r, eval=FALSE}
# NOT RUN
install.packages('reticulate') # answer yes
library(reticulate)
# python dependencies
conda_install('r-reticulate', c('msprime','ete3','pandas'))
```

<!--
### Repo github

### CRAN

-->
## Single simulation

```{r}
# First we need to import the python module 
eco <- import('ecophylo')
# Be carefull for idiotproof of ecophylo and int class ! we need to 
eco$timeframes(I=as.integer(3), T=2, a=0.3)
sim1 <- eco$simulate(as.integer(10), as.integer(1e5), as.numeric(0.03), seed = as.integer(42))
sim1
```

```{python, eval=FALSE, include = FALSE} 
# HIDDEN CHUNK
# same code in python. Noneed to modify to int here
import ecophylo as eco
# NOT RUN
eco.simulate(100, 1e4, 1e-3)
```

## Multiple simulations

```{r, eval=FALSE}
# NOT RUN
truc <- eco$dosimuls(nsim = 1, sample_size = 100, comprior = list(1000,10e9),
             muprior = list(1e-3) , verbose = TRUE, seed = 42)
```

```{python, eval=FALSE}
# NOT RUN
eco.dosimuls(nsim = 5, sample_size = 100, comprior = [1000,10e9], 
             muprior = [1e-3] , verbose = True, seed = 42)
```


<!--
## Adding Migrations
-->

